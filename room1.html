<html>
<head>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.5.0/dist/aframe-cursor-teleport-component.min.js"></script>
  <link rel="stylesheet" type="text/css" href="indexStyles.css">
  <!-- <script src="../scripts/script.js"></script> -->
  <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>

</head>



<body >
  <a-scene 
  device-orientation-permission-ui="enabled: false"
  cursor="rayOrigin: mouse"
  raycaster="objects: [data-clickable]"
  animation-timeline__1="timeline: #myTimeline; loop:true"
  >
    <a-assets>
    <a-asset-item id="scene-glb" src="./Models/room.glb"></a-asset-item>
    <a-asset-item id="jump" src="./Models/jump2.glb"></a-asset-item>
    <a-asset-item id="strength" src="./Models/strength.glb"></a-asset-item>
    <a-asset-item id="jump" src="./Models/white.glb"></a-asset-item>
    <a-asset-item id="chair" src="./Models/chair.glb"></a-asset-item>
    <a-asset-item id="desktop" src="./Models/desktop.glb"></a-asset-item>
    <a-asset-item id="step" src="./Models/step.glb"></a-asset-item>
    <a-asset-item id="push" src="./Models/figurePush.glb"></a-asset-item>
    <a-asset-item id="jumpFigure" src="./Models/figureJump.glb"></a-asset-item>
      <img id="welcome" src="./Images/Welcome.png">
      <img id="task" src="./Images/task.png">
      <img id="purpose" src="./Images/purpose.png">
      <img id="safety" src="./Images/safety.png">
      <img id="safety-exp" src="./Images/safety-exp.png">
      <img id="purpose-exp" src="./Images/purpose-exp.png">
      <img id="indicator" src="./Images/indicator.png">
      <img id="task-jump" src="./Images/task-jump.png">
      <img id="purpose-jump" src="./Images/purpose-jump.png">
      <img id="safety-jump" src="./Images/safety-jump.png">
      <img id="safety-jump-exp" src="./Images/safety-jump-exp.png">
      <img id="purpose-jump-exp" src="./Images/purpose-jump-exp.png">


      <!-- <video id="videoBunny" preload="auto" src="https://cdn.aframe.io/videos/bunny.mp4" width="160" height="90" autoplay loop="true" crossOrigin="anonymous" muted></video> -->

    </a-assets>

    <a-entity light="type: ambient; color: #FFF; intensity: 0.8" position="-2.7 11.6 1.7"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.8" position="-2.7 11.6 1.7"></a-entity>
    <!-- <a-entity environment="preset: default"></a-entity> -->


    <a-entity gltf-model="#scene-glb" scale="0.8 0.8 0.8" position="-2 -0.39 4"></a-entity>
    <a-entity gltf-model="#strength" scale="0.6 0.6 0.6" position="-1.94 -0.28 4" rotation="0 0 0" id="#newId"></a-entity>
    <a-entity gltf-model="#step" scale="0.6 0.6 0.6" position="3.24 -1 -14.4" rotation="0 180 0"></a-entity>
    <a-entity gltf-model="#jump" scale="2.5 2.5 2.5" position="5 -0.39 -9" rotation="0 -90 0"></a-entity>
    <a-entity gltf-model="#chair" scale="0.6 0.6 0.6" position="-2 -0.28 4"></a-entity>
    <a-entity gltf-model="#desktop" scale="2 2 2" position="10 -0.39 -5" rotation="-90 0 0"></a-entity>
    <!-- <a-entity gltf-model="#jump" scale="2 2 2" position="0 0 0" rotation="0 0 0"></a-entity> -->






    <a-entity id="cameraRig" cursor-teleport="cameraRig: #cameraRig; cameraHead: #head; ignoreEntities: .clickable" effect-manager>
      <a-entity id="head" position="0 2 0" camera look-controls="reverseMouseDrag: true" wasd-controls="acceleration:30" proximity-effect="target: #ring-strength; threshold: 1.5; infoPanel:#info-panel-0">
        <a-cylinder id="effects" position="0.9 0 0" height="3" radius="2.5" color=#000000"
                        material="opacity: 0.4; side: double;" visible="false"></a-cylinder>
      </a-entity>

    </a-entity>



    <!-- <a-entity environment="preset: default"></a-entity> -->
    <a-ring id="ring-strength"  color="teal" radius-inner="0.3" radius-outer="0.35" 
    position="5.9 0.011 -1.05" rotation="-90 0 0" teleport-and-play>
    <a-image src="#indicator" scale="0.3 0.3 0.3" rotation="0 0 90"> </a-image> </a-ring>

    <a-ring id="ring-jump"  color="teal" radius-inner="0.3" radius-outer="0.35" 
    position="6.5 0.011 -6.05" rotation="-90 0 0" teleport-and-play>
    <a-image src="#indicator" scale="0.3 0.3 0.3" rotation="0 0 0"> </a-image> </a-ring>

    <a-entity gltf-model="#push" scale="0.8 0.8 0.8" position="4.9 -0.08 -1" rotation="0 -90 0" animation__yoyo="property: position; dir: alternate; dur: 1000;
    easing: easeInSine; loop: true; to: 4.49 -0.08 -1"></a-entity>
    <a-entity gltf-model="#jumpFigure" scale="0.8 0.8 0.8" position="6.5 -0.2 -6.53" rotation="0 180 0" animation__yoyo="property: position; dir: alternate; dur: 1000;
    easing: easeInSine; loop: true; to:6.5 0.7 -6.53"></a-entity>


    <a-entity position="4.5 2.2 0.2" rotation="0 90 0" scale="0.5 0.5 0.5" id="info-panel-0" visible="false">
      <a-image src="#task" class="clickable" position="0 0 0" id="task1" data-clickable scale="1.8 0.7 0.7"
      ></a-image>
      <a-image src="#purpose" position="0 -0.5 0" scale="1.8 0.4 1"
      data-clickable id="purpose1" class="clickable"
      onclick="toggleDropdown('purpose1', 'purpose2', 'safety1')"
      event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
      event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"
      ></a-image>

      <a-image src="#safety"  position="0 -0.9 0" scale="1.8 0.4 1"
      data-clickable id="safety1" class="clickable"
      onclick="toggleDropdown('safety1', 'safety2', 'none')"
      event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
      event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"></a-image>

      <a-image src="#purpose-exp" id="purpose2" class="clickable" position="0 -0.65 0" scale="1.8 0.7 1" visible="false" 
    ></a-image>
      <a-image src="#safety-exp" id="safety2" class="clickable" position="0 -1.2 0" scale="1.8 0.7 1" visible="false"
    ></a-image>
    </a-entity>
    <a-image src="#purpose" id="none" visible="false"></a-image>



    <a-entity position="5 2.2 -5" rotation="0 0 0" scale="0.5 0.5 0.5" id="info-panel-1" visible="false">
      <a-image src="#task-jump" class="clickable" position="0 0 0" id="task1" data-clickable scale="1.8 0.7 0.7"
      ></a-image>
      <a-image src="#purpose-jump" position="0 -0.5 0" scale="1.8 0.4 1"
      data-clickable id="purpose1-jump" class="clickable"
      onclick="toggleDropdown('purpose1-jump', 'purpose2-jump', 'safety1-jump')"
      event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
      event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"
      ></a-image>

      <a-image src="#safety-jump"  position="0 -0.9 0" scale="1.8 0.4 1"
      data-clickable id="safety1-jump" class="clickable"
      onclick="toggleDropdown('safety1-jump', 'safety2-jump', 'none')"
      event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
      event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"></a-image>

      <a-image src="#purpose-jump-exp" id="purpose2" class="clickable" position="0 -0.65 0" scale="1.8 0.7 1" visible="false" 
    ></a-image>
      <a-image src="#safety-jump-exp" id="safety2" class="clickable" position="0 -1.2 0" scale="1.8 0.7 1" visible="false"
    ></a-image>
    </a-entity>
    <a-image src="#purpose" id="none" visible="false"></a-image>




  </a-scene>






  <div class="nav-container">
    <input type="checkbox" id="toggle" checked />
    <label class="button" for="toggle">
      <nav class="nav">
        <ul>
          <li><a href="./index.html"><img src="Images/home.png" width="50%"></a></li>
          <li><a href="./room1.html"><img src="Images/room.png" width="40%"></a></li>
          <li><a href="#0"><img src="Images/audio.png" width="40%"></a></li>
        </ul>
      </nav>
    </label>


  </div>


    <button class="signup-btn">Sign Up</button>




    

    <script>
      function closePanel(panelId) {
          document.getElementById(panelId).style.display = "none";
      }
  
      function openPanel(panelId) {
          document.getElementById(panelId).style.display = "flex";
      }

      AFRAME.registerComponent('proximity-effect',{
        schema:{
          target:{type:'selector'},
          threshold:{type:'number',default:1},
          infoPanel: { type: 'selector'}

        },
        init:function(){
          this.target=this.data.target;
          this.threshold=this.data.threshold;
          this.infoPanel = this.data.infoPanel;
          this.effectActive=false;
        },
        tick:function(){
          var cameraRigPosition = this.el.object3D.position;
          var targetPosition = this.target.object3D.position;

          var distanceXZ = Math.sqrt(Math.pow(cameraRigPosition.x - targetPosition.x, 2) + Math.pow(cameraRigPosition.z - targetPosition.z, 2));

          //check if within threshold 
          if(distanceXZ <=this.threshold && !this.effectActive ){
            this.effectActive = true;
            this.el.querySelector('#effects').setAttribute('visible',true);
            this.infoPanel.setAttribute('visible', true); // Make the info panel visible
            console.log("entered");
          }
          else if(distanceXZ > this.threshold && this.effectActive){
            this.effectActive = false;
            this.el.querySelector('#effects').setAttribute('visible',false);
            this.infoPanel.setAttribute('visible', false); // Hide the info panel
          }
        }

      });



      function toggleDropdown(toggleId, contentId, nextId) {
        var contentEl = document.getElementById(contentId);
        var nextEl = document.getElementById(nextId);
        var contentVisible = contentEl.getAttribute('visible');
        var toggleEl = document.getElementById(toggleId);
        // Toggle visibility of the content element
        contentEl.setAttribute('visible', !contentVisible);
      
        // Reset position of the next element to its original state before adjusting
        var originalPositionY = nextEl.getAttribute('data-original-position-y');
        if (originalPositionY === null) {
          // Store the original position y if it's not stored yet
          originalPositionY = nextEl.getAttribute('position').y-0.2;
          nextEl.setAttribute('data-original-position-y', originalPositionY);
        } else {
          // Reset the position to the original position before any toggles
          nextEl.setAttribute('position', { x: nextEl.getAttribute('position').x, y: originalPositionY, z: nextEl.getAttribute('position').z });
        }
        
        // Adjust position based on the visibility of the content element
        var deltaY = contentVisible ? 0.25 : -0.1; // The height of the dropdown content
        var newPosY = parseFloat(originalPositionY) + deltaY;
      
        // Set the new position for the next element
        nextEl.setAttribute('position', { x: nextEl.getAttribute('position').x, y: newPosY, z: nextEl.getAttribute('position').z });

      }
      
      </script>
</body>



</html>


<html>
<head>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.5.0/dist/aframe-cursor-teleport-component.min.js"></script>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <!-- <script src="../scripts/script.js"></script> -->
  <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>

</head>



<body >
  <a-scene 
  device-orientation-permission-ui="enabled: false"
  cursor="rayOrigin: mouse"
  raycaster="objects: [data-clickable]"
  animation-timeline__1="timeline: #myTimeline; loop:true"
  >
    <a-assets>
    <a-asset-item id="scene-glb" src="./Models/room.glb"></a-asset-item>

    <a-asset-item id="strength" src="./Models/Strength_equipment.glb"></a-asset-item>

    <a-asset-item id="chair" src="./Models/chair.glb"></a-asset-item>
    <a-asset-item id="desktop" src="./Models/desktop.glb"></a-asset-item>
    <a-asset-item id="step" src="./Models/step.glb"></a-asset-item>
    <a-asset-item id="push" src="./Models/figurePush.glb"></a-asset-item>

      <img id="welcome" src="./Images/Welcome.png">
      <img id="task" src="./Images/task-new.png">
      <img id="purpose" src="./Images/purpose.png">
      <img id="safety" src="./Images/equipment.png">
      <img id="safety-exp" src="./Images/equipment-exp.png">
      <img id="purpose-exp" src="./Images/purpose-exp.png">
      <img id="indicator" src="./Images/indicator.png">
      <img id="data1" src="./Images/data1.png">
      <img id="ring-glow" src="./Images/ring-glow.png">
      <img id="exit" src="./Images/exit-arrow.png"> 
      <img id="hover-text" src="./Images/hover-text-exit.png">
      <img id="device-label0" src="./Images/device-label0.png">
      <img id="device-label3" src="./Images/device-label3.png">

    </a-assets>


    <a-entity light="type: ambient; color: #fff; intensity: 0.5" position="7.84 5 -8" id="ambient-1"></a-entity>
    <a-entity light="type: spot; color: #b5a1c9; intensity: 0.33 angle: 90" position="1.3 5.181 7.6" id="spot-light-front"></a-entity>
    <a-entity light="type: spot; color: #dec995; intensity: 0.39; angle:120" position="10 -0.13 12.7"  id="spot-light"></a-entity>
    <a-entity light="type: spot; color: #d3c7f0; intensity: 0.3; angle:60" position="4.2 1.5 -17" rotation="0 180 0" id="spot-light-left"></a-entity>
    <a-entity light="type: spot; color: #f0e0ed; intensity: 0.1; angle:30" position="14.2 -1.5 -2.8" rotation="0 90 0" id="spot-light-back"></a-entity>

    <a-entity light="type: directional; color: #fad6ff; intensity: 0.29 angle:120" position="5.68 1.8 -0.92"  id="point-light-right"></a-entity>

    <a-entity gltf-model="#scene-glb" scale="1 1 1" position="-2.25 -0.5 4.8" rotation="0 0 0"></a-entity>
    <a-entity gltf-model="#step" scale="0.8 0.8 0.8" position="3.24 -1 -18.4" rotation="0 180 0"></a-entity>


    <a-entity gltf-model="#chair" scale="0.6 0.6 0.6" position="-2 -0.28 4.35"></a-entity>
    <!-- <a-entity environment="preset: default"></a-entity> -->

    <a-entity geometry="primitive:plane" position="0 9.52 0" rotation="90 0 0" scale="100 100 100" id="roof" material="color:#dbe6ff; emissive:#4d4c4c" ></a-entity>

    <a-entity id="cameraRig" cursor-teleport="cameraRig: #cameraRig; cameraHead: #head; ignoreEntities: .clickable" effect-manager>
      <a-entity id="head" position="-1 2.5 3" camera 
      rotation="0 -45 0"
      look-controls="reverseMouseDrag: true"
      wasd-controls="acceleration:30" 
      proximity-effect="targets: #ring-strength, #ring-desktop; threshold: 1.5; infoPanels:#info-panel-0, #info-panel-1"
      restrict-movement="minX: -1; maxX: 14; minZ: -7; maxZ: 4">
        <a-cylinder id="effects" position="0 -2 0" height="10" radius="4" color=#000000"
                        material="opacity: 0.4; side: double;" visible="false"></a-cylinder>
      </a-entity>

      
    </a-entity>


<!-- desktop -->
<a-image src="#ring-glow" position="11.44 0.011 -5.22" rotation="-90 -90 0" scale="12 12 12"
class="clickable" 
id="ring-desktop"
><a-image src="#indicator" scale="0.02 0.02 0.02" rotation="0 0 90" position="0 0.001 0"> </a-image> </a-image>

<a-entity gltf-model="#desktop" scale="2.4 2.4 2.4" position="11.79 -0.39 -7.44" rotation="-90 90 0">
</a-entity>
<a-image src="#device-label3" position="12.38 1.9 -5.99" scale="1.07 0.38 1" look-at="#cameraRig" rotation="-15 0 0"> </a-image>

<a-image src="#data1" position="10.51 2.7 -6" rotation="0 0 0" scale="1.25 1.25 1.25" id="info-panel-1" visible="false"> </a-image>




    <!-- strength -->
    <a-image src="#ring-glow" position="8.46 0.021 -2.95" rotation="-90 0 0" scale="12 12 12"
    class="clickable" 
    id="ring-strength"
    ><a-image src="#indicator" scale="0.02 0.02 0.02" rotation="0 0 90" position="0 0.001 0"> </a-image> </a-image>
  

<a-entity id="strength-parent" position="2.85 0 -2.09">


  <a-entity gltf-model="#strength" scale="3.5 3.5 3.5" position="-4.09 -1.05 6.9" rotation="0 180 0" id="#strength-device"></a-entity>
  <a-image src="#device-label0" position="3.4 3.2 -0.778" scale="1.33 0.46 1" look-at="#cameraRig" rotation="-15 90 0"> </a-image>
  <a-entity position="4.5 2.5 0.2" rotation="0 90 0" scale="0.5 0.5 0.5" id="info-panel-0" visible="false">
    <a-entity gltf-model="#push" scale="1.7 1.7 1.7" position="2.12 -5 0.1" rotation="0 -180 0" animation__yoyo="property: position; dir: alternate; dur: 2500; pauseEvents: 2; resumeEvents: 4;
  easing: easeInSine; loop: true; to: 2.12 -5 1"></a-entity>

    <a-image src="#task" class="clickable" position="0 0 0" id="task1" data-clickable scale="1.8 0.7 0.7"
    ></a-image>
    <a-image src="#purpose" position="0 -0.5 0" scale="1.8 0.4 1"
    data-clickable id="purpose1" class="clickable"
    onclick="toggleDropdown('purpose1', 'purpose2', 'safety1')"
    event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
    event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"
    ></a-image>

    <a-image src="#safety"  position="0 -0.9 0" scale="1.8 0.4 1"
    data-clickable id="safety1" class="clickable"
    onclick="toggleDropdown('safety1', 'safety2', 'none')"
    event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
    event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"></a-image>

    <a-image src="#purpose-exp" id="purpose2" class="clickable" position="0 -0.65 0" scale="1.8 0.7 1" visible="false" 
  ></a-image>
    <a-image src="#safety-exp" id="safety2" class="clickable" position="0 -1.2 0" scale="1.8 0.7 1" visible="false"
  ></a-image>
  </a-entity>
  <a-image src="#purpose" id="none" visible="false"></a-image>

</a-entity>





<a-image src="#exit" position="9.23 0.074 1.99" id="exit-ring" rotation="-90 90 0" class="clickable interactive-image">
  <a-image src="#hover-text" class="hover-text" scale="1.5 0.75 0" rotation="90 0 0" position="0 0 0.65" visible="false"> </a-image>
    </a-image>






  </a-scene>






  <div class="nav-container">
    <input type="checkbox" id="toggle" checked />
    <label class="button" for="toggle">
      <nav class="nav">
        <ul>
          <li><a href="./index.html"><img src="Images/home-new.png" width="50%">
          <button class="tooltip"> HOME </button>
          </a></li>
          <!-- <li><a href="./room1.html"><img src="Images/menu-new.png" width="50%"></a></li> -->
          <li><a id="studies-button" href="#"><img src="Images/menu-new.png" width="50%">
            <button class="tooltip"> STUDIES </button>
          
          </a> </li>
          <li><a href="#0"><img src="Images/audio.png" width="40%">
            <button class="tooltip"> AUDIO </button>
          </a></li>
        </ul>
      </nav>
    </label>
  </div>
  
  <div id="studies-detail" class="studies-info" style="display: none;">
    <h4>EXPLORE OTHER STUDIES</h4>
    <a href="#0" class="study-link">Strength Study</a>
    <a href="./room_bodyshape.html" class="study-link">Size and Shape Study</a>
  </div>

<!-- <div class="signup-btn">
  <a href="https://umhealthresearch.org/studies/HUM00231054" id="signup"> JOIN STUDY </a>
</div> -->

<div class="signup-btn-wrapper">
  <div class="signup-btn">
    <a href="https://umhealthresearch.org/studies/HUM00231054" id="signup">JOIN NOW</a>
    <div class="popup">
      <p>Get $50 for 2 hours of your time. Join the study today!</p>
    </div>
  </div>
</div>


    

    <script>

      document.addEventListener('DOMContentLoaded', function() {
        // Get the A-Frame elements for the rings
        var ring = document.querySelector('#exit-ring');
        const images = document.querySelectorAll('.interactive-image');
        images.forEach((image) => {
          const text = image.querySelector('.hover-text');
  
          image.addEventListener('mouseenter', () => text.setAttribute('visible', true));
          image.addEventListener('mouseleave', () => text.setAttribute('visible', false));
      });
  
        // Add an event listener for the 'click' event on the first ring
        ring.addEventListener('click', function() {
            // Navigate to room1.html when the first ring is clicked
            window.location.href = './index.html?cameraPosition=-17,0,-15';
        });
    
    });
  

      document.addEventListener('DOMContentLoaded', function() {
    var studiesButton = document.getElementById('studies-button'); // The button to toggle the studies detail
    var studiesDetail = document.getElementById('studies-detail'); // The container for the studies links
    
    studiesButton.addEventListener('click', function(event) {
      event.preventDefault(); // Prevent the default anchor action
      var isHidden = studiesDetail.style.display === 'none';
      studiesDetail.style.display = isHidden ? 'block' : 'none';
    });
  });

      AFRAME.registerComponent('proximity-effect',{
        schema:{
          targets:{type:'array'},
          threshold:{type:'number',default:1},
          infoPanels: { type: 'array'}

        },
        init: function() {
          // Convert target selectors into actual elements
          this.targets = this.data.targets.map(selector => document.querySelector(selector)).filter(el => el !== null);
          // Convert infoPanel selectors into actual elements
          this.infoPanels = this.data.infoPanels.map(selector => document.querySelector(selector)).filter(el => el !== null);
          this.threshold = this.data.threshold;
          this.lastActiveIndex = -1; // Keep track of the last active target
          this.effectActive=false;

        },
        tick: function() {
          var cameraRigPosition = this.el.object3D.position;
          var activeIndex = -1;
      
          // Check each target's distance and determine the active one
          this.targets.forEach((target, index) => {
            if (!target) return; // Continue if target is not a valid element
      
            var targetPosition = target.object3D.position;
            var distanceXZ = Math.sqrt(
              Math.pow(cameraRigPosition.x - targetPosition.x, 2) + 
              Math.pow(cameraRigPosition.z - targetPosition.z, 2)
            );
      
            if (distanceXZ <= this.threshold) {
              activeIndex = index;
            }
          });
      
          // Hide the last active info panel if any
          if (this.lastActiveIndex !== -1 && this.infoPanels[this.lastActiveIndex]) {
            this.infoPanels[this.lastActiveIndex].setAttribute('visible', false);
            this.el.querySelector('#effects').setAttribute('visible',false);
            this.effectActive=false;

          }
      
          // Show the new active info panel if any
          if (activeIndex !== -1 && this.infoPanels[activeIndex]) {
            this.infoPanels[activeIndex].setAttribute('visible', true);
            this.effectActive=true;
            this.el.querySelector('#effects').setAttribute('visible',true);

          }
      
          // Update the last active index
          this.lastActiveIndex = activeIndex;
        }

      });



      function toggleDropdown(toggleId, contentId, nextId) {
        var contentEl = document.getElementById(contentId);
        var nextEl = document.getElementById(nextId);
        var contentVisible = contentEl.getAttribute('visible');
        var toggleEl = document.getElementById(toggleId);
        // Toggle visibility of the content element
        contentEl.setAttribute('visible', !contentVisible);
      
        // Reset position of the next element to its original state before adjusting
        var originalPositionY = nextEl.getAttribute('data-original-position-y');
        if (originalPositionY === null) {
          // Store the original position y if it's not stored yet
          originalPositionY = nextEl.getAttribute('position').y-0.2;
          nextEl.setAttribute('data-original-position-y', originalPositionY);
        } else {
          // Reset the position to the original position before any toggles
          nextEl.setAttribute('position', { x: nextEl.getAttribute('position').x, y: originalPositionY, z: nextEl.getAttribute('position').z });
        }
        
        // Adjust position based on the visibility of the content element
        var deltaY = contentVisible ? 0.25 : -0.1; // The height of the dropdown content
        var newPosY = parseFloat(originalPositionY) + deltaY;
      
        // Set the new position for the next element
        nextEl.setAttribute('position', { x: nextEl.getAttribute('position').x, y: newPosY, z: nextEl.getAttribute('position').z });

      }
      

      AFRAME.registerComponent('restrict-movement', {
        schema: {
          minX: { type: 'number', default: -10 },
          maxX: { type: 'number', default: 10 },
          minZ: { type: 'number', default: -10 },
          maxZ: { type: 'number', default: 10 }
        },
        tick: function () {
          var position = this.el.getAttribute('position');
          
          if (position.x < this.data.minX) {
            position.x = this.data.minX;
          } else if (position.x > this.data.maxX) {
            position.x = this.data.maxX;
          }
          
          if (position.z < this.data.minZ) {
            position.z = this.data.minZ;
          } else if (position.z > this.data.maxZ) {
            position.z = this.data.maxZ;
          }
          
          this.el.setAttribute('position', position);
        }
      });




      </script>
</body>



</html>


<html>
<head>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.5.0/dist/aframe-cursor-teleport-component.min.js"></script>
  <!-- <link rel="stylesheet" type="text/css" href="./styles.css"> -->
  <link rel="stylesheet" type="text/css" href="./styles.css">
  <!-- <script src="../scripts/script.js"></script> -->

</head>




<body>


  <a-scene device-orientation-permission-ui="enabled: false"
  cursor="rayOrigin: mouse">
    <a-assets>
    
    <a-asset-item id="room" src="./Models/room-bodyshape.glb"></a-asset-item>
    <a-asset-item id="jump" src="./Models/JUMP_CLEARED.glb"></a-asset-item>
    <a-asset-item id="desktop" src="./Models/desktop.glb"></a-asset-item>

    <a-asset-item id="figureScan" src="./Models/figureScan.glb"></a-asset-item>

    <a-asset-item id="desktop" src="./Models/desktop.glb"></a-asset-item>

    <a-asset-item id="jumpFigure" src="./Models/figureJump.glb"></a-asset-item>
    <a-asset-item id="bodyScan" src="./Models/bodyScanGLB.glb"></a-asset-item>
      <img id="indicator" src="./Images/indicator.png">
      <img id="task-jump" src="./Images/task-jump.png">
      <img id="purpose-jump" src="./Images/purpose-jump.png">
      <img id="purpose" src="./Images/purpose-jump.png">
      <img id="safety-jump" src="./Images/equipment-jump.png">
      <img id="safety-jump-exp" src="./Images/equipment-jump-exp.png">
      <img id="purpose-jump-exp" src="./Images/purpose-jump-exp.png">
      <img id="task-scan" src="./Images/task-scan.png">
      <img id="purpose-scan" src="./Images/purpose-scan.png">
      <img id="safety-scan" src="./Images/equipment-scan.png">
      <img id="safety-scan-exp" src="./Images/equipment-scan-exp.png">
      <img id="purpose-scan-exp" src="./Images/purpose-scan-exp.png">
      <img id="ring-glow" src="./Images/ring-glow.png"> 
      <img id="exit" src="./Images/exit-arrow.png"> 
      <img id="hover-text" src="./Images/hover-text-exit.png">
      <img id="data2" src="./Images/data2.png">

      <img id="device-label1" src="./Images/device-label1.png">
      <img id="device-label2" src="./Images/device-label2.png">
      <img id="device-label3" src="./Images/device-label3.png">


    </a-assets>



    <a-entity id="cameraRig" cursor-teleport="cameraRig: #cameraRig; cameraHead: #head; ignoreEntities: .clickable" effect-manager>
      <a-entity id="head" position="0 2.5 0" camera 
      rotation="0 0 0"
      look-controls="reverseMouseDrag: true"
      wasd-controls="acceleration:30" 
      restrict-movement="minX: -1; maxX: 12; minZ: -7; maxZ: 2"
      proximity-effect="targets: #ring-desktop, #ring-jump, #ring-scan; threshold: 1.5; infoPanels:#info-panel-0, #info-panel-1, #info-panel-2"
      >
        <a-cylinder id="effects" position="0 -2 0" height="10" radius="4" color=#000000" rotation="0 0 0"
                        material="opacity: 0.4; side: double;" visible="false"></a-cylinder>
      </a-entity>
    </a-entity>


    <a-entity gltf-model="#desktop" scale="2.4 2.4 2.4" position="8.79 -0.39 -3.54" rotation="-90 0 0"></a-entity>
    <a-image src="#ring-glow" position="6.45 0.54 -3.84" rotation="-90 -90 0" scale="12 12 12"
    class="clickable" 
    id="ring-desktop"
    ><a-image src="#indicator" scale="0.02 0.02 0.02" rotation="0 0 0" position="0 0.001 0"> </a-image> </a-image>
  <a-image src="#device-label3" position="7.18 2.04 -2.89" scale="1.07 0.38 1" look-at="#cameraRig" rotation="-15 -90 0"> </a-image>

  <a-image src="#data2" position="7.774 2.7 -4.89" rotation="0 -90 0" scale="1.5 1.5 1.5" id="info-panel-0" visible="false"> </a-image>


    <a-entity gltf-model="#room" scale="35 35 35" position="29.15 -0.09 -12" rotation="0 0 0"></a-entity>

        <!-- jump -->

        <a-image src="#ring-glow" position="5.187 0.54 -6.96" rotation="-90 0 0" scale="12 12 12"
        class="clickable" 
        id="ring-jump"
        ><a-image src="#indicator" scale="0.02 0.02 0.02" rotation="0 0 0" position="0 0.001 0"> </a-image> </a-image>
    
        <a-entity id="jump-parent" position="-1.47 0.86 -0.92">

          <a-image src="#device-label1" position="6.67 3.55 -8.2" scale="1.33 0.46 1" look-at="#cameraRig" rotation="15 0 0"> </a-image>
          
          <a-entity gltf-model="#jump" scale="0.1 0.12 0.12" position="5.17 -0.39 -10.04" rotation="0 -90 0"></a-entity>
          <a-entity position="5.3 1.8 -7" rotation="-5 0 0" scale="0.5 0.5 0.5" id="info-panel-1" visible="false">
            <a-entity gltf-model="#jumpFigure" scale="1.6 1.6 1.6" position="2.59 -3.5 -0.46" rotation="0 180 0" animation__yoyo="property: position; dir: alternate; dur: 1000;
            easing: easeInSine; loop: true; to:2.59 -1.83 -0.46"></a-entity>
      
      
            <a-image src="#task-jump" class="clickable" position="0 0 0" id="task1" data-clickable scale="1.8 0.7 0.7"
            ></a-image>
            <a-image src="#purpose-jump" position="0 -0.5 0" scale="1.8 0.4 1"
            data-clickable id="purpose1-jump" class="clickable"
            onclick="toggleDropdown('purpose1-jump', 'purpose2-jump', 'safety1-jump')"
            event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
            event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"
            ></a-image>
      
            <a-image src="#safety-jump"  position="0 -0.9 0" scale="1.8 0.4 1"
            data-clickable id="safety1-jump" class="clickable"
            onclick="toggleDropdown('safety1-jump', 'safety2-jump', 'none')"
            event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
            event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"></a-image>
      
            <a-image src="#purpose-jump-exp" id="purpose2-jump" class="clickable" position="0 -0.65 0" scale="1.8 0.7 1" visible="false" 
          ></a-image>
            <a-image src="#safety-jump-exp" id="safety2-jump" class="clickable" position="0 -1.2 0" scale="1.8 0.7 1" visible="false"
          ></a-image>
          </a-entity>
          <a-image src="#purpose" id="none" visible="false"></a-image>
        </a-entity>
    
    
    <!-- scan -->
    
    <a-image src="#ring-glow" position="0.83 0.56 -4.49" rotation="-90 0 0" scale="12 12 12"
    class="clickable" 
    id="ring-scan"
    ><a-image src="#indicator" scale="0.02 0.02 0.02" rotation="0 0 90" position="0 0.002 0"> </a-image> </a-image>

        <a-entity id="scan-parent" position="-0.63 0.45 -2" rotation="0 0 0">
          <a-image src="#device-label2" position="0.65 3.96 -2.5" scale="1.33 0.46 1" look-at="#cameraRig" rotation="15 90 0"> </a-image>

    
          <a-entity gltf-model="#bodyScan" scale="40 40 40" position="0.5 0 -1.5" rotation="0 90 0"></a-entity>
    
          <a-entity position="1 1.8 -1.5" rotation="-5 90 0" scale="0.5 0.5 0.5" id="info-panel-2" visible="false">
            <a-entity gltf-model="#figureScan" scale="1.3 1.3 1.3" position="2 -2.4 -0.9" rotation="0 180 0"></a-entity>
        
              <a-image src="#task-scan" class="clickable" position="0 0 0"  data-clickable scale="1.8 0.7 0.7"
              ></a-image>
              <a-image src="#purpose-scan" position="0 -0.5 0" scale="1.8 0.4 1"
              data-clickable id="purpose1-scan" class="clickable"
              onclick="toggleDropdown('purpose1-scan', 'purpose2-scan', 'safety1-scan')"
              event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
              event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"
              ></a-image>
        
              <a-image src="#safety-scan"  position="0 -0.9 0" scale="1.8 0.4 1"
              data-clickable id="safety1-scan" class="clickable"
              onclick="toggleDropdown('safety1-scan', 'safety2-scan', 'none')"
              event-set__enter="_event: mouseenter;  width: 0.53; height: 0.53;"
              event-set__leave="_event: mouseleave;  width: 0.5; height: 0.5;"></a-image>
        
              <a-image src="#purpose-scan-exp" id="purpose2-scan" class="clickable" position="0 -0.65 0" scale="1.8 0.7 1" visible="false" 
            ></a-image>
              <a-image src="#safety-scan-exp" id="safety2-scan" class="clickable" position="0 -1.2 0" scale="1.8 0.7 1" visible="false"
            ></a-image>
            </a-entity>
            <a-image src="#purpose" id="none" visible="false"></a-image>
        </a-entity>
    
    
        <a-image src="#exit" position="-0.8 0.57 1.27" id="exit-ring" rotation="-90 90 0" class="clickable interactive-image">
      <a-image src="#hover-text" class="hover-text" scale="1.5 0.75 0" rotation="90 0 0" position="0 0 0.65" visible="false"> </a-image>

        </a-image>


    
  </a-scene>



<!-- <div class="overlay" id="overlay"></div> -->

<div class="nav-container">
  <input type="checkbox" id="toggle" checked />
  <label class="button" for="toggle">
    <nav class="nav">
      <ul>
        <li><a href="./index.html"><img src="Images/home-new.png" width="50%">
        <button class="tooltip"> HOME </button>
        </a></li>
        <!-- <li><a href="./room1.html"><img src="Images/menu-new.png" width="50%"></a></li> -->
        <li><a id="studies-button" href="#"><img src="Images/menu-new.png" width="50%">
          <button class="tooltip"> STUDIES </button>
        
        </a> </li>
        <li><a href="#0"><img src="Images/audio.png" width="40%">
          <button class="tooltip"> AUDIO </button>
        </a></li>
      </ul>
    </nav>
  </label>
</div>

<div id="studies-detail" class="studies-info" style="display: none;">
  <h4>EXPLORE OTHER STUDIES</h4>
  <a href="./room1.html" class="study-link">Strength Study</a>
  <a href="./room-body.html" class="study-link">Size and Shape Study</a>
</div>

<div class="signup-btn-wrapper">
  <div class="signup-btn">
    <a href="https://umhealthresearch.org/studies/HUM00231054" id="signup">JOIN NOW</a>
    <div class="popup">
      <p>Get $50 for 2 hours of your time. Join the study today!</p>
    </div>
  </div>
</div>



  <script>

    document.addEventListener('DOMContentLoaded', function() {
      // Get the A-Frame elements for the rings
      var ring = document.querySelector('#exit-ring');

      // Add an event listener for the 'click' event on the first ring
      ring.addEventListener('click', function() {
          // Navigate to room1.html when the first ring is clicked
          
          window.location.href = './index.html?cameraPosition=-17,0,-15';
      });
  
  });

  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const cameraPosition = urlParams.get('cameraPosition');
    if (cameraPosition) {
        const positionArray = cameraPosition.split(',').map(Number);
        const cameraRig = document.querySelector('#cameraRig');
        if (cameraRig) {
            cameraRig.setAttribute('position', {x: positionArray[0], y: positionArray[1], z: positionArray[2]});
            console.log("success");
        }
    }
});


  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.interactive-image');

    images.forEach((image) => {
        const text = image.querySelector('.hover-text');

        image.addEventListener('mouseenter', () => text.setAttribute('visible', true));
        image.addEventListener('mouseleave', () => text.setAttribute('visible', false));
    });
});

  AFRAME.registerComponent('proximity-effect',{
    schema:{
      targets:{type:'array'},
      threshold:{type:'number',default:1},
      infoPanels: { type: 'array'}

    },
    init: function() {
      // Convert target selectors into actual elements
      this.targets = this.data.targets.map(selector => document.querySelector(selector)).filter(el => el !== null);
      // Convert infoPanel selectors into actual elements
      this.infoPanels = this.data.infoPanels.map(selector => document.querySelector(selector)).filter(el => el !== null);
      this.threshold = this.data.threshold;
      this.lastActiveIndex = -1; // Keep track of the last active target
      this.effectActive=false;

    },
    tick: function() {
      var cameraRigPosition = this.el.object3D.position;
      var activeIndex = -1;
  
      // Check each target's distance and determine the active one
      this.targets.forEach((target, index) => {
        if (!target) return; // Continue if target is not a valid element
  
        var targetPosition = target.object3D.position;
        var distanceXZ = Math.sqrt(
          Math.pow(cameraRigPosition.x - targetPosition.x, 2) + 
          Math.pow(cameraRigPosition.z - targetPosition.z, 2)
        );
  
        if (distanceXZ <= this.threshold) {
          activeIndex = index;
        }
      });
  
      // Hide the last active info panel if any
      if (this.lastActiveIndex !== -1 && this.infoPanels[this.lastActiveIndex]) {
        this.infoPanels[this.lastActiveIndex].setAttribute('visible', false);
        this.el.querySelector('#effects').setAttribute('visible',false);
        this.effectActive=false;

      }
  
      // Show the new active info panel if any
      if (activeIndex !== -1 && this.infoPanels[activeIndex]) {
        this.infoPanels[activeIndex].setAttribute('visible', true);
        this.effectActive=true;
        this.el.querySelector('#effects').setAttribute('visible',true);

      }
  
      // Update the last active index
      this.lastActiveIndex = activeIndex;
    }

  });



  function toggleDropdown(toggleId, contentId, nextId) {
    var contentEl = document.getElementById(contentId);
    var nextEl = document.getElementById(nextId);
    var contentVisible = contentEl.getAttribute('visible');
    var toggleEl = document.getElementById(toggleId);
    // Toggle visibility of the content element
    contentEl.setAttribute('visible', !contentVisible);
  
    // Reset position of the next element to its original state before adjusting
    var originalPositionY = nextEl.getAttribute('data-original-position-y');
    if (originalPositionY === null) {
      // Store the original position y if it's not stored yet
      originalPositionY = nextEl.getAttribute('position').y-0.2;
      nextEl.setAttribute('data-original-position-y', originalPositionY);
    } else {
      // Reset the position to the original position before any toggles
      nextEl.setAttribute('position', { x: nextEl.getAttribute('position').x, y: originalPositionY, z: nextEl.getAttribute('position').z });
    }
    
    // Adjust position based on the visibility of the content element
    var deltaY = contentVisible ? 0.25 : -0.1; // The height of the dropdown content
    var newPosY = parseFloat(originalPositionY) + deltaY;
  
    // Set the new position for the next element
    nextEl.setAttribute('position', { x: nextEl.getAttribute('position').x, y: newPosY, z: nextEl.getAttribute('position').z });

  }
  

  AFRAME.registerComponent('restrict-movement', {
    schema: {
      minX: { type: 'number', default: -10 },
      maxX: { type: 'number', default: 10 },
      minZ: { type: 'number', default: -10 },
      maxZ: { type: 'number', default: 10 }
    },
    tick: function () {
      var position = this.el.getAttribute('position');
      
      if (position.x < this.data.minX) {
        position.x = this.data.minX;
      } else if (position.x > this.data.maxX) {
        position.x = this.data.maxX;
      }
      
      if (position.z < this.data.minZ) {
        position.z = this.data.minZ;
      } else if (position.z > this.data.maxZ) {
        position.z = this.data.maxZ;
      }
      
      this.el.setAttribute('position', position);
    }
  });



  document.addEventListener('DOMContentLoaded', function() {
    var studiesButton = document.getElementById('studies-button'); // The button to toggle the studies detail
    var studiesDetail = document.getElementById('studies-detail'); // The container for the studies links
    
    studiesButton.addEventListener('click', function(event) {
      event.preventDefault(); // Prevent the default anchor action
      var isHidden = studiesDetail.style.display === 'none';
      studiesDetail.style.display = isHidden ? 'block' : 'none';
    });
  });



    </script>

</body>

</html>
